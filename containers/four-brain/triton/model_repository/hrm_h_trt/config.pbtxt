# HRM H-Module (High-level Strategic Planning) Configuration
# Optimized for Blackwell GPU with FP8 precision (always loaded)
# 27M parameter model for strategic planning and task decomposition

name: "hrm_h_trt"
platform: "tensorrt_plan"
max_batch_size: 0
version_policy: { all { }}

input [
  {
    name: "input_ids"
    data_type: TYPE_INT64
    dims: [ -1, -1 ]
  },
  {
    name: "attention_mask"
    data_type: TYPE_INT64
    dims: [ -1, -1 ]
  },
  {
    name: "task_type"
    data_type: TYPE_STRING
    dims: [ -1 ]
  },
  {
    name: "context"
    data_type: TYPE_STRING
    dims: [ -1 ]
  },
  {
    name: "constraints"
    data_type: TYPE_STRING
    dims: [ -1 ]
  }
]

output [
  {
    name: "strategic_plan"
    data_type: TYPE_STRING
    dims: [ -1 ]
  },
  {
    name: "confidence"
    data_type: TYPE_FP32
    dims: [ -1 ]
  },
  {
    name: "next_steps"
    data_type: TYPE_STRING
    dims: [ -1, -1 ]
  },
  {
    name: "convergence_score"
    data_type: TYPE_FP32
    dims: [ -1 ]
  }
]

instance_group [
  {
    count: 1
    kind: KIND_GPU
    gpus: [ 0 ]
  }
]

# Blackwell-specific optimizations
optimization {
  graph: {
    level: 3
  }
  execution_accelerators: {
    gpu_execution_accelerator: [
      {
        name: "tensorrt"
        parameters: {
          key: "precision_mode"
          value: "FP8"
        }
      },
      {
        name: "tensorrt"
        parameters: {
          key: "max_workspace_size_bytes"
          value: "2147483648"  # 2GB
        }
      },
      {
        name: "tensorrt"
        parameters: {
          key: "enable_thread_block_clustering"
          value: "true"
        }
      },
      {
        name: "tensorrt"
        parameters: {
          key: "enable_tma_optimization"
          value: "true"
        }
      },
      {
        name: "tensorrt"
        parameters: {
          key: "enable_dpx_instructions"
          value: "true"
        }
      }
    ]
  }
}

# Dynamic batching for improved throughput
dynamic_batching {
  preferred_batch_size: [ 1, 2 ]
  max_queue_delay_microseconds: 100
}

# Performance parameters
parameters: {
  key: "TRT_MAX_WORKSPACE_SIZE_BYTES"
  value: {
    string_value: "2147483648"
  }
}

parameters: {
  key: "TRT_FP8_ENABLE"
  value: {
    string_value: "1"
  }
}

parameters: {
  key: "TRT_BLACKWELL_OPTIMIZATIONS"
  value: {
    string_value: "1"
  }
}

