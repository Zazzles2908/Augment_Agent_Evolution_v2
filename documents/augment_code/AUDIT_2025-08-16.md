# Four-Brain Project Audit — 2025-08-16

Scope: repository hygiene, misplaced scripts, large/committed model artifacts, Triton repository sanity, and alignment with architecture plan.

## Summary
- Fixed: removed stray files created outside Four‑Brain tree
  - Deleted: src/brain3_intelligence/hrm_vector_controller.py
  - Deleted: src/shared/vector_communication.py
  - Deleted: scripts/deploy_vector_native_system.py
- Findings: versioned Triton model artifacts committed under containers/four-brain/triton/model_repository
  - qwen3_embedding/1 contains many weight files and ONNX variants (should not be versioned)
  - qwen3_embedding_trt/1 contains model.plan (TensorRT engine) — generated artifact; should not be versioned
  - hrm_h_trt/1 and hrm_l_trt/1 contain model.onnx — likely placeholders; better to fetch/build into runtime paths
- .gitignore includes a rule to ignore containers/**/triton/model_repository/**/[0-9]*/, but artifacts appear to be already tracked (must be purged from index)
- Top-level src/ directories now empty (src/brain3_intelligence, src/shared) — safe to remove
- No sensitive .env files detected in quick scan; main environment resides under containers/four-brain

## Action Items (Repo Hygiene)
1) Purge previously committed model artifacts and engines from git history/index (keep config.pbtxt only):
   - containers/four-brain/triton/model_repository/hrm_h_trt/1/**
   - containers/four-brain/triton/model_repository/hrm_l_trt/1/**
   - containers/four-brain/triton/model_repository/qwen3_embedding_trt/1/model.plan
   - containers/four-brain/triton/model_repository/qwen3_reranker_trt/1/model.onnx
   - containers/four-brain/triton/model_repository/qwen3_embedding/1/**
   - containers/four-brain/triton/model_repository/docling_gpu/1/**

2) Remove empty top-level directories:
   - src/brain3_intelligence/
   - src/shared/

3) Keep Triton model repository structure (config.pbtxt + version folders), but populate version folders at runtime/build only, not in VCS.

4) Confirm .gitignore enforcement for artifact files:
   - Verify rule: containers/**/triton/model_repository/**/[0-9]*/
   - Add explicit patterns if necessary (e.g., *.onnx, *.plan under model_repository) — optional if (1) cleaned properly

## Suggested Git Commands (Run Locally)
```powershell
# Create clean branch for audit cleanup
git checkout -b audit/cleanup-artifacts-2025-08-16

# Remove committed artifacts from index (preserve files locally)
git rm -r --cached "containers/four-brain/triton/model_repository/**/1/*"

# Optionally remove specific tracked engines if not covered by glob
# git rm --cached containers/four-brain/triton/model_repository/qwen3_embedding_trt/1/model.plan

# Ensure .gitignore is in place (already includes versioned directories rule)
# If you add/adjust ignore rules, commit .gitignore changes

# Remove empty top-level src directories from repo
git rm -r --cached src/brain3_intelligence src/shared 2>$null

# Commit cleanup
git commit -m "Audit: purge tracked Triton model artifacts and remove stray src dirs"
```

If the artifacts remain tracked after the above, you may need to use `git rm -r --cached` with more explicit paths, then commit again.

## Alignment with Architecture Plan
- Architecture doc updated with honest status and optimization hooks.
- No functional claims until real models/engines are built and deployed.
- Triton repository will be populated by build scripts at deploy time instead of committed to VCS.

## Next Steps (After Cleanup Commit)
1) Hardware & environment validation (CUDA/Blackwell) — run:
   - python containers/four-brain/scripts/system/check_cuda_details.py
2) Download real models (Qwen3 Embedding/Reranker) to models/ and/or runtime cache
3) Export ONNX and build TensorRT engines (NVFP4/FP8) into containers/four-brain/triton/model_repository/*/1 at build time (not committed)
4) Bring up Docker services and run end-to-end tests
5) Record real metrics and update docs accordingly

## Notes
- No evidence of leaked secrets or dangerous data found in this pass.
- The main risk observed is committed artifacts inflating repo size and causing drift.
- The cleanup branch isolates history; a follow-up PR can be reviewed before merging to main.

